<!DOCTYPE html>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layout/main-layout :: layout(~{::title}, ~{::section})}">
<head>
    <title>Gerenciar Administradores</title>
</head>
<body>
<section>
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h1>Administradores de Pátio</h1>
        <a th:href="@{/admin/onboarding/novo}" class="btn btn-primary">
            <i class="bi bi-person-plus-fill"></i> Adicionar Novo
        </a>
    </div>

    <div class="card shadow-sm mb-4">
        <div class="card-body d-flex justify-content-end align-items-center">
            <form th:action="@{/admin/usuarios}" method="get" class="d-flex align-items-center">
                <label for="status" class="form-label me-2 mb-0">Filtrar por Status:</label>
                <select id="status" name="status" class="form-select me-2" style="width: auto;" onchange="this.form.submit()">
                    <option value="ATIVO" th:selected="${filtroStatus == 'ATIVO'}">Ativos</option>
                    <option value="REMOVIDO" th:selected="${filtroStatus == 'REMOVIDO'}">Removidos</option>
                    <option value="SUSPENSO" th:selected="${filtroStatus == 'SUSPENSO'}">Suspensos</option>
                </select>
            </form>
        </div>
    </div>

    <div class="card shadow-sm">
        <div class="card-body">
            <table class="table table-hover align-middle">
                <thead class="table-dark">
                <tr>
                    <th>ID do Admin</th>
                    <th>Nome</th>
                    <th>Email</th>
                    <th>Pátio Responsável</th>
                    <th>Status</th>
                    <th class="text-end">Ações</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="vm : ${adminsPage.content}">
                    <td><small class="text-muted font-monospace" th:text="${vm.admin().id}"></small></td>
                    <td th:text="${vm.admin().nome}"></td>
                    <td th:text="${vm.admin().email}"></td>
                    <td th:text="${vm.nomePateo()}"></td>
                    <td>
                        <span class="badge"
                              th:classappend="${vm.admin().status.name() == 'ATIVO'} ? 'bg-success' : (${vm.admin().status.name() == 'SUSPENSO'} ? 'bg-warning text-dark' : 'bg-danger')"
                              th:text="${vm.admin().status.name()}"></span>
                    </td>
                    <td class="text-end">
                        <form th:if="${vm.admin().status.name() == 'REMOVIDO'}" th:action="@{/admin/usuarios/{id}/reativar(id=${vm.admin().id})}" method="post" class="d-inline">
                            <button type="submit" class="btn btn-sm btn-outline-success" title="Reativar">
                                <i class="bi bi-arrow-counterclockwise"></i>
                            </button>
                        </form>

                        <div th:if="${vm.admin().status.name() != 'REMOVIDO'}" class="d-inline">
                             <a th:href="@{/admin/usuarios/{id}/editar(id=${vm.admin().id})}" class="btn btn-sm btn-outline-warning" title="Editar">
                                <i class="bi bi-pencil-square"></i>
                            </a>
                            <form th:action="@{/admin/usuarios/{id}/desativar(id=${vm.admin().id})}" method="post" class="d-inline"
                                  onsubmit="return confirm('Isso desativará o usuário E todos os pátios gerenciados por ele. Confirma?');">
                                <button type="submit" class="btn btn-sm btn-outline-danger" title="Desativar">
                                    <i class="bi bi-trash-fill"></i>
                                </button>
                            </form>
                        </div>
                    </td>
                </tr>
                <tr th:if="${adminsPage.empty}">
                    <td colspan="6" class="text-center p-4">Nenhum administrador encontrado para este filtro.</td>
                </tr>
                </tbody>
            </table>

            <nav th:if="${adminsPage.totalPages > 1}">
                <ul class="pagination justify-content-center">
                    <li class="page-item" th:classappend="${adminsPage.first} ? 'disabled'">
                        <a class="page-link" th:href="@{/admin/usuarios(page=${adminsPage.number-1}, status=${filtroStatus})}">Anterior</a>
                    </li>
                    <li class="page-item" th:each="i : ${#numbers.sequence(0, adminsPage.totalPages - 1)}" th:classappend="${i == adminsPage.number} ? 'active'">
                        <a class="page-link" th:href="@{/admin/usuarios(page=${i}, status=${filtroStatus})}" th:text="${i + 1}"></a>
                    </li>
                    <li class="page-item" th:classappend="${adminsPage.last} ? 'disabled'">
                        <a class="page-link" th:href="@{/admin/usuarios(page=${adminsPage.number+1}, status=${filtroStatus})}">Próximo</a>
                    </li>
                </ul>
            </nav>
        </div>
    </div>
</section>
</body>
</html>